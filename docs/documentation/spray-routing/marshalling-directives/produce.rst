.. _-produce-:

produce
=======

Uses the marshaller for a given type to produce a completion function that is passed to its 
inner route.  You can use it to decouple marshaller resolution from request completion.  

Signature
---------

.. includecode:: /../spray-routing/src/main/scala/spray/routing/directives/MarshallingDirectives.scala
   :snippet: produce[T]

Description
-----------

The ``produce`` directive works in conjuction with ``instanceOf`` and ``spray.httpx.marshalling`` 
to convert higher-level (object) structure into some lower-level serialized "wire format".
:ref:`The marshalling documentation <marshalling>` explains this process in detail.
This directive simplifies exposing types to clients via a route while providing some
form of access to the current context.

``produce`` is similar to ``handleWith``.  The main difference is with ``produce`` you must eventually call the completion function generated by produce.  ``handleWith`` will automatically call
``complete`` when the ``handleWith`` function returns.

Examples
--------

The following example uses ``spray-json`` to marshall a simple ``Person`` class to a json
response.  It utilizes ``SprayJsonSupport`` via the ``PersonJsonSupport`` object as the in-scope
unmarshaller.

.. includecode:: ../code/docs/directives/MarshallingDirectivesExamplesSpec.scala
   :snippet: person-json-support 

.. includecode:: ../code/docs/directives/MarshallingDirectivesExamplesSpec.scala
   :snippet: person-case-class

The ``findPerson`` takes an argument of type ``Person => Unit`` which is generated by the ``produce``
call.  We can handle any logic we want in ``findPerson`` and call our completion function to
complete the request.

.. includecode:: ../code/docs/directives/MarshallingDirectivesExamplesSpec.scala
   :snippet: example-produce-with-json
